<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì²­ì†Œêµ¬ì—­ ë°°ì •</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 700px;
      margin: auto;
    }
    h1, h2 {
      margin-top: 30px;
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    table, th, td {
      border: 1px solid #aaa;
      padding: 8px;
      text-align: center;
    }
    #adminPanel {
      display: none;
      margin-top: 20px;
    }
    .box {
      border: 1px solid #999;
      padding: 10px;
      margin-bottom: 10px;
      flex: 1;
    }
    input[type="text"] {
      width: 100%;
      padding: 6px;
      margin: 4px 0;
      box-sizing: border-box;
    }
    .highlight {
      background-color: #f0f0f0;
      padding: 10px;
      margin-bottom: 10px;
    }
    .flex-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
      table, input[type="text"] {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <h1>ì²­ì†Œêµ¬ì—­ ë°°ì • ì‹œìŠ¤í…œ</h1>
  <div id="dateInfo"></div>
  <div id="cleaningTable"></div>

  <button onclick="showAdmin()">ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</button>

  <div id="adminPanel">
    <p>ë¹„ë°€ë²ˆí˜¸: <input type="password" id="adminPassword" /> <button onclick="checkPassword()">í™•ì¸</button></p>
    <div id="adminEdit" style="display:none;">
      <h2>ì²­ì†Œêµ¬ì—­ ë° í•™ìƒëª… ìˆ˜ì •</h2>
      <div class="flex-container">
        <div class="box">
          <strong>ì²­ì†Œêµ¬ì—­</strong><br/>
          <div id="zoneInputs"></div>
        </div>
        <div class="box">
          <strong>í•™ìƒëª…</strong><br/>
          <div id="studentInputs"></div>
        </div>
      </div>
      <button onclick="saveEdits()">ì €ì¥</button>
      <div id="saveMessage" style="margin-top:10px; color: green;"></div>
    </div>
  </div>

  <script>
    const defaultZones = [
      "ë¹—ìë£¨, ëŒ€ê±¸ë˜, ë¶„ë¦¬ìˆ˜ê±°",
      "ë¹—ìë£¨, ëŒ€ê±¸ë˜, ë¶„ë¦¬ìˆ˜ê±°",
      "í™˜ê¸°, ë¹—ìë£¨, ëŒ€ê±¸ë˜",
      "ì†ê±¸ë˜, ì„¸ì ˆê¸°",
      "ì†ê±¸ë˜, ì„¸ì ˆê¸°",
      "êµì‚¬ì“°ë ˆê¸°í†µ, ì „ì²´ ì“°ë ˆê¸°í†µ ì •ë¦¬"
    ];

    const defaultStudents = [
      "ë°•ì°¬ì§„", "ì´ë™í˜„", "ì •ì§€í›ˆ", "ì •í•œì˜", "í•˜í˜„ì¼", "í—ˆìœ¤ì¬"
    ];

    const daysKor = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
    const cleaningDays = [1, 3, 5]; // ì›”, ìˆ˜, ê¸ˆ

    function hashCode(str) {
      let hash = 0;
      for (let i = 0; i < str.length; i++) {
        hash = (hash << 5) - hash + str.charCodeAt(i);
        hash |= 0;
      }
      return hash;
    }

    function getSeedFromDate(dateString) {
      const baseDateStr = new Date(dateString).toISOString().split('T')[0];
      const hash = Math.abs(hashCode(baseDateStr)).toString();
      return parseInt(hash[5]); // ì•ì—ì„œ 6ë²ˆì§¸ ìë¦¬ ìˆ«ì
    }

    function shuffle(seed) {
      const array = [1, 2, 3, 4, 5, 6];
      for (let i = array.length - 1; i > 0; i--) {
        const j = seed % (i + 1);
        [array[i], array[j]] = [array[j], array[i]];
        seed = (seed * 9301 + 49297) % 233280;
      }
      return array;
    }

    function getNextCleaningDate(date) {
      const next = new Date(date);
      do {
        next.setDate(next.getDate() + 1);
      } while (!cleaningDays.includes(next.getDay()));
      return next;
    }

    function loadData(key, fallback) {
      const data = localStorage.getItem(key);
      return data ? JSON.parse(data) : fallback;
    }

    function saveData(key, data) {
      localStorage.setItem(key, JSON.stringify(data));
    }

    function renderTable(date, isTodayCleaning) {
      const zones = loadData("zones", defaultZones);
      const students = loadData("students", defaultStudents);
      const dateStr = date.toISOString().split('T')[0];
      const seed = getSeedFromDate(dateStr);
      const order = shuffle(seed);

      let html = `<h2>${isTodayCleaning ? "ì˜¤ëŠ˜" : "ë‹¤ìŒ ì²­ì†Œì¼"} (${dateStr}) ì²­ì†Œêµ¬ì—­ ë°°ì •í‘œ</h2>`;
      html += `<table><tr><th>ì´ë¦„</th><th>ì²­ì†Œêµ¬ì—­</th></tr>`;
      for (let i = 0; i < 6; i++) {
        html += `<tr><td>${students[order[i] - 1]}</td><td>${zones[i]}</td></tr>`;
      }
      html += `</table>`;
      return html;
    }

    function render() {
      const now = new Date();
      const todayStr = now.toISOString().split('T')[0];
      const day = now.getDay();
      const dateInfo = document.getElementById("dateInfo");
      const tableDiv = document.getElementById("cleaningTable");

      dateInfo.innerHTML = `<div class="highlight"><strong>ì˜¤ëŠ˜ ë‚ ì§œ:</strong> ${todayStr} (${daysKor[day]})</div>`;

      if (cleaningDays.includes(day)) {
        tableDiv.innerHTML = renderTable(now, true);
      } else {
        const nextDate = getNextCleaningDate(now);
        tableDiv.innerHTML = `<p>ì˜¤ëŠ˜ì€ ë´‰ì‚¬ìš”ì¼ì´ ì•„ë‹™ë‹ˆë‹¤.</p>
                              <p><strong>ë‹¤ìŒ ì²­ì†Œì¼:</strong> ${nextDate.toISOString().split('T')[0]}</p>
                              ${renderTable(nextDate, false)}`;
      }
    }

    function showAdmin() {
      document.getElementById("adminPanel").style.display = "block";
    }

    function checkPassword() {
      const input = document.getElementById("adminPassword").value;
      if (input === "1214") {
        document.getElementById("adminEdit").style.display = "block";
        renderAdminInputs();
      } else {
        alert("ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤");
      }
    }

    function renderAdminInputs() {
      const zones = loadData("zones", defaultZones);
      const students = loadData("students", defaultStudents);
      const zoneInputs = document.getElementById("zoneInputs");
      const studentInputs = document.getElementById("studentInputs");

      zoneInputs.innerHTML = "";
      studentInputs.innerHTML = "";

      for (let i = 0; i < 6; i++) {
        zoneInputs.innerHTML += `<input type="text" id="zone${i}" value="${zones[i]}"><br/>`;
        studentInputs.innerHTML += `<input type="text" id="student${i}" value="${students[i]}"><br/>`;
      }
    }

    function saveEdits() {
      const zones = [], students = [];
      for (let i = 0; i < 6; i++) {
        zones.push(document.getElementById(`zone${i}`).value);
        students.push(document.getElementById(`student${i}`).value);
      }
      saveData("zones", zones);
      saveData("students", students);
      document.getElementById("saveMessage").innerText = "ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤";
      render(); // ë°˜ì˜í•´ì„œ ë‹¤ì‹œ ë³´ì—¬ì¤Œ
    }

    render();
  </script>
</body>
</html>
